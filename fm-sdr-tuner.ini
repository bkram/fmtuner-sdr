# FM-SDR-Tuner configuration file
# Run with: ./build/fm-sdr-tuner -c fm-sdr-tuner.ini
# CLI flags override values here.

# =========================
# SDR Input / RF Tuning
# =========================

[tuner]
# Source: rtl_sdr (direct USB) or rtl_tcp (network server)
source = rtl_sdr

# RTL-SDR device index when source=rtl_sdr
rtl_device = 0

# Startup frequency in kHz (88600 = 88.6 MHz)
default_freq = 88600

# De-emphasis: 0=50us, 1=75us, 2=off
deemphasis = 0

[rtl_tcp]
# Used only when source=rtl_tcp
host = localhost
port = 1234

# RTL input sample rate.
# Supported: 256000, 1024000, 2048000.
# Higher rates are front-end decimated to 256000 for the DSP stereo chain.
sample_rate = 256000

[sdr]
# Gain strategy:
#   tef   = TEF-like A/G behavior (supports auto clip-protect loop)
#   sdrpp = SDR++-style gain behavior
gain_strategy = tef

# Manual tuner gain in dB.
#   -1 = strategy-managed gain
#   >=0 = force fixed manual gain (overrides strategy)
rtl_gain_db = -1

# RTL frequency correction in ppm (set from known dongle offset)
freq_correction_ppm = 0

# Packed custom gain flags (tef strategy): tens=RF, ones=IF
# Example: 11 => RF=1, IF=1
default_custom_gain_flags = 1

# SDR++ strategy options (used when gain_strategy=sdrpp)
sdrpp_rtl_agc = false
sdrpp_rtl_agc_gain_db = 18

# Quick presets:
#
# Preset A: TEF (stable, auto clip-protect)
#   gain_strategy = tef
#   rtl_gain_db = -1
#   default_custom_gain_flags = 1
#   agc_mode = 2
#
# Preset B: SDR++ (predictable/manual-like)
#   gain_strategy = sdrpp
#   rtl_gain_db = -1
#   sdrpp_rtl_agc = false
#   sdrpp_rtl_agc_gain_db = 18
#   agc_mode = 2   ; ignored by sdrpp strategy

# Signal meter mapping window (dBFS)
signal_floor_dbfs = -55.0
# Keep strong locals near ~100 on 0..120 scale (reduce top-end saturation)
signal_ceil_dbfs = -12.0
# Meter calibration bias in dB (negative = lower indicated level)
signal_bias_db = -6.0

# Drop stale IQ backlog when overloaded
low_latency_iq = false

# =========================
# Audio / Decode
# =========================

[audio]
# Enable speaker output by default (same as -s)
enable_audio = true

# Startup audio volume in percent (0..100)
startup_volume = 80

# Output device index/name (empty = system default)
device = BlackHole 2ch

[processing]
# TEF AGC profile (0..3). Used by gain_strategy=tef.
agc_mode = 2

# Allow client-issued gain commands (XDR)
client_gain_allowed = true

# DSP block size (IQ samples per processing cycle)
dsp_block_samples = 8192

# FM channel bandwidth hint in Hz (194000 recommended for WFM stereo)
w0_bandwidth_hz = 194000

# Optional DSP AGC before FM discriminator: off, fast, slow
dsp_agc = off

# Stereo blend profile: soft, normal, aggressive
stereo_blend = normal

# Enable stereo decoder
stereo = true

# =========================
# Network / Service
# =========================

[xdr]
# XDR server TCP port
port = 7373

# Optional password (empty = no auth)
password = test123

# Allow guest mode without password
guest_mode = false

[reconnection]
# Auto reconnect after repeated IQ read failures
auto_reconnect = true

[debug]
# 0=quiet, 1=info, 2+=verbose
log_level = 1
